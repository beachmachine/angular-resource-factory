<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>phantomIdFactory/phantomIdFactoryService.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="scripts/prettify/springeo.js" defer async></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/springeo.css">
    <link type="text/css" rel="stylesheet" href="styles/simple-jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><input id="search" type="search" placeholder="Search..."><h3>Classes</h3><ul id=classes><li><a href="ResourceCacheService.html"><div class="ancestor"></div>ResourceCacheService</a><ul class='methods'><li data-type='method'><a href="ResourceCacheService.html#.get">get</a></li><li data-type='method'><a href="ResourceCacheService.html#.info">info</a></li><li data-type='method'><a href="ResourceCacheService.html#.removeAll">removeAll</a></li><li data-type='method'><a href="ResourceCacheService.html#destroy">destroy</a></li><li data-type='method'><a href="ResourceCacheService.html#get">get</a></li><li data-type='method'><a href="ResourceCacheService.html#info">info</a></li><li data-type='method'><a href="ResourceCacheService.html#insert">insert</a></li><li data-type='method'><a href="ResourceCacheService.html#put">put</a></li><li data-type='method'><a href="ResourceCacheService.html#refresh">refresh</a></li><li data-type='method'><a href="ResourceCacheService.html#remove">remove</a></li><li data-type='method'><a href="ResourceCacheService.html#removeAll">removeAll</a></li><li data-type='method'><a href="ResourceCacheService.html#removeAllDependent">removeAllDependent</a></li><li data-type='method'><a href="ResourceCacheService.html#removeAllLists">removeAllLists</a></li><li data-type='method'><a href="ResourceCacheService.html#removeAllObjects">removeAllObjects</a></li><li data-type='method'><a href="ResourceCacheService.html#removeAllRaw">removeAllRaw</a></li></ul></li><li><a href="ResourceFactoryService.html"><div class="ancestor"></div>ResourceFactoryService</a><ul class='methods'><li data-type='method'><a href="ResourceFactoryService.html#createStore">createStore</a></li><li data-type='method'><a href="ResourceFactoryService.html#filter">filter</a></li><li data-type='method'><a href="ResourceFactoryService.html#filterInstancesByAttr">filterInstancesByAttr</a></li><li data-type='method'><a href="ResourceFactoryService.html#filterNoCache">filterNoCache</a></li><li data-type='method'><a href="ResourceFactoryService.html#getCache">getCache</a></li><li data-type='method'><a href="ResourceFactoryService.html#getCacheClass">getCacheClass</a></li><li data-type='method'><a href="ResourceFactoryService.html#getInstanceByAttr">getInstanceByAttr</a></li><li data-type='method'><a href="ResourceFactoryService.html#getInstanceByPk">getInstanceByPk</a></li><li data-type='method'><a href="ResourceFactoryService.html#getPkAttr">getPkAttr</a></li><li data-type='method'><a href="ResourceFactoryService.html#getQueryDataAttr">getQueryDataAttr</a></li><li data-type='method'><a href="ResourceFactoryService.html#getQueryFilters">getQueryFilters</a></li><li data-type='method'><a href="ResourceFactoryService.html#getQueryTotalAttr">getQueryTotalAttr</a></li><li data-type='method'><a href="ResourceFactoryService.html#getResourceName">getResourceName</a></li><li data-type='method'><a href="ResourceFactoryService.html#isPhantom">isPhantom</a></li><li data-type='method'><a href="ResourceFactoryService.html#new">new</a></li><li data-type='method'><a href="ResourceFactoryService.html#persist">persist</a></li><li data-type='method'><a href="ResourceFactoryService.html#setDefaultQueryFilters">setDefaultQueryFilters</a></li><li data-type='method'><a href="ResourceFactoryService.html#setQueryFilters">setQueryFilters</a></li></ul></li><li><a href="ResourcePhantomIdFactory.html"><div class="ancestor"></div>ResourcePhantomIdFactory</a><ul class='methods'><li data-type='method'><a href="ResourcePhantomIdFactory.html#generate">generate</a></li><li data-type='method'><a href="ResourcePhantomIdFactory.html#isPhantom">isPhantom</a></li></ul></li><li><a href="ResourcePhantomIdFactoryService.html"><div class="ancestor"></div>ResourcePhantomIdFactoryService</a><ul class='methods'><li data-type='method'><a href="ResourcePhantomIdFactoryService.html#.createPhantomIdFactory">createPhantomIdFactory</a></li></ul></li><li><a href="ResourceStore.html"><div class="ancestor"></div>ResourceStore</a><ul class='methods'><li data-type='method'><a href="ResourceStore.html#addAfterPersistListener">addAfterPersistListener</a></li><li data-type='method'><a href="ResourceStore.html#addAfterRemoveListener">addAfterRemoveListener</a></li><li data-type='method'><a href="ResourceStore.html#addBeforePersistListener">addBeforePersistListener</a></li><li data-type='method'><a href="ResourceStore.html#addBeforeRemoveListener">addBeforeRemoveListener</a></li><li data-type='method'><a href="ResourceStore.html#commit">commit</a></li><li data-type='method'><a href="ResourceStore.html#createChildStore">createChildStore</a></li><li data-type='method'><a href="ResourceStore.html#createRelation">createRelation</a></li><li data-type='method'><a href="ResourceStore.html#execute">execute</a></li><li data-type='method'><a href="ResourceStore.html#executeAll">executeAll</a></li><li data-type='method'><a href="ResourceStore.html#forget">forget</a></li><li data-type='method'><a href="ResourceStore.html#getByInstance">getByInstance</a></li><li data-type='method'><a href="ResourceStore.html#getByPk">getByPk</a></li><li data-type='method'><a href="ResourceStore.html#getManagedInstances">getManagedInstances</a></li><li data-type='method'><a href="ResourceStore.html#getPersistQueue">getPersistQueue</a></li><li data-type='method'><a href="ResourceStore.html#getRemoveQueue">getRemoveQueue</a></li><li data-type='method'><a href="ResourceStore.html#getResourceService">getResourceService</a></li><li data-type='method'><a href="ResourceStore.html#getSaveQueue">getSaveQueue</a></li><li data-type='method'><a href="ResourceStore.html#getUpdateQueue">getUpdateQueue</a></li><li data-type='method'><a href="ResourceStore.html#getVisibleQueue">getVisibleQueue</a></li><li data-type='method'><a href="ResourceStore.html#manage">manage</a></li><li data-type='method'><a href="ResourceStore.html#new">new</a></li><li data-type='method'><a href="ResourceStore.html#persist">persist</a></li><li data-type='method'><a href="ResourceStore.html#remove">remove</a></li><li data-type='method'><a href="ResourceStore.html#removeAfterPersistListener">removeAfterPersistListener</a></li><li data-type='method'><a href="ResourceStore.html#removeAfterRemoveListener">removeAfterRemoveListener</a></li><li data-type='method'><a href="ResourceStore.html#removeBeforePersistListener">removeBeforePersistListener</a></li><li data-type='method'><a href="ResourceStore.html#removeBeforeRemoveListener">removeBeforeRemoveListener</a></li><li data-type='method'><a href="ResourceStore.html#removeRelation">removeRelation</a></li></ul></li><li><a href="ResourceStoreRelation.html"><div class="ancestor"></div>ResourceStoreRelation</a><ul class='methods'><li data-type='method'><a href="ResourceStoreRelation.html#getFkAttr">getFkAttr</a></li><li data-type='method'><a href="ResourceStoreRelation.html#getRelatedStore">getRelatedStore</a></li><li data-type='method'><a href="ResourceStoreRelation.html#getStore">getStore</a></li><li data-type='method'><a href="ResourceStoreRelation.html#handleDispose">handleDispose</a></li><li data-type='method'><a href="ResourceStoreRelation.html#handleRemove">handleRemove</a></li><li data-type='method'><a href="ResourceStoreRelation.html#handleUpdate">handleUpdate</a></li></ul></li></ul><h3>Global</h3><ul id="global"><li><a href="global.html#ResourcePhantomIdNegativeInt">ResourcePhantomIdNegativeInt</a></li><li><a href="global.html#ResourcePhantomIdUuid4">ResourcePhantomIdUuid4</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">phantomIdFactory/phantomIdFactoryService.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Angular ResourcePhantomIdFactoryService
 * Copyright 2016 Andreas Stocker
 * MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS
 * OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */


(function () {
    'use strict';

    var
        module = angular.module('ngResourceFactory');

    /**
     * Factory service to generate new resource phantom id generators.
     *
     * @name ResourcePhantomIdFactoryService
     * @ngdoc service
     * @see ResourcePhantomIdNegativeInt
     * @see ResourcePhantomIdUuid4
     * @class
     *
     * @example
     * // ResourcePhantomIdFactory that creates negative IDs as phantom IDs (NOTE: this is already a build-in
     * // phantom ID factory, so you do not have to implement this - @see ResourcePhantomIdNegativeInt)
     * inject(function (ResourceFactoryService, ResourcePhantomIdFactoryService) {
     *     var
     *         lastPkValue = 0,
     *         generator = ResourcePhantomIdFactoryService.createPhantomIdFactory({
     *             generate: function () {
     *                 return --lastPkValue;
     *             },
     *             is: function (pkValue) {
     *                 return pkValue &lt; 0;
     *             }
     *         }),
     *         service = ResourceFactoryService('TestResourceService', 'http://test/:pk/', {
     *             phantomIdGenerator: generator
     *         }),
     *         phantomInstance1 = service.new(),
     *         phantomInstance2 = service.new();
     *
     *     expect(phantomInstance1.$isPhantom()).toBe(true);
     *     expect(phantomInstance2.$isPhantom()).toBe(true);
     *
     *     // Change IDs to non-negative numbers
     *     phantomInstance1.pk = 1;
     *     phantomInstance2.pk = 2;
     *
     *     expect(phantomInstance1.$isPhantom()).toBe(false);
     *     expect(phantomInstance2.$isPhantom()).toBe(false);
     * });
     */
    module.service('ResourcePhantomIdFactoryService',
        function () {
            'ngInject';

            var
                self = this;

            /**
             * Creates a new phantom id generator with the given configuration.
             *
             * @memberOf ResourcePhantomIdFactoryService
             * @function createPhantomIdFactory
             * @param {{generate: Function, is: Function}} config Configuration object for new phantom ID factory
             * @return {ResourcePhantomIdFactory} New phantom ID factory instance
             * @static
             */
            self.createPhantomIdFactory = function (config) {
                config = angular.extend({
                    generate: function () { },
                    is: function () { }
                }, config);

                return new ResourcePhantomIdFactory(config.generate, config.is);
            };

            /**
             * Constructor function for a phantom id generate. Takes a function that generates the PK, and a
             * functions that checks if the given PK is a phantom PK.
             *
             * @name ResourcePhantomIdFactory
             * @param {Function} generateFn Function that returns a new, phantom ID. Gets the instance as the first parameter
             * @param {Function} isPhantomFn Function that checks if the first given parameter is a phantom ID. Gets the instance as the second parameter
             * @see ResourcePhantomIdNegativeInt
             * @see ResourcePhantomIdUuid4
             * @class
             *
             * @example
             * // ResourcePhantomIdFactory that creates negative IDs as phantom IDs (NOTE: this is already a build-in
             * // phantom ID factory, so you do not have to implement this)
             * inject(function (ResourceFactoryService, ResourcePhantomIdFactoryService) {
             *     var
             *         lastPkValue = 0,
             *         generator = ResourcePhantomIdFactoryService.createPhantomIdFactory({
             *             generate: function () {
             *                 return --lastPkValue;
             *             },
             *             is: function (pkValue) {
             *                 return pkValue &lt; 0;
             *             }
             *         }),
             *         service = ResourceFactoryService('TestResourceService', 'http://test/:pk/', {
             *             phantomIdGenerator: generator
             *         }),
             *         phantomInstance1 = service.new(),
             *         phantomInstance2 = service.new();
             *
             *     expect(phantomInstance1.$isPhantom()).toBe(true);
             *     expect(phantomInstance2.$isPhantom()).toBe(true);
             *
             *     // Change IDs to non-negative numbers
             *     phantomInstance1.pk = 1;
             *     phantomInstance2.pk = 2;
             *
             *     expect(phantomInstance1.$isPhantom()).toBe(false);
             *     expect(phantomInstance2.$isPhantom()).toBe(false);
             * });
             */
            function ResourcePhantomIdFactory (generateFn, isPhantomFn) {
                var
                    self = this;

                /**
                 * Generates a new phantom PK value
                 *
                 * @memberof ResourcePhantomIdFactory
                 * @function generate
                 * @param {ResourceInstance} instance Instance to generate the phantom ID for
                 * @return {String|int}
                 * @instance
                 */
                self.generate = function (instance) {
                    return generateFn(instance);
                };

                /**
                 * Checks if the given PK value on the given instance is a phantom PK value
                 *
                 * @memberof ResourcePhantomIdFactory
                 * @function isPhantom
                 * @param {String|int} pkValue ID value to check
                 * @param {ResourceInstance} instance Instance to work on
                 * @return {*}
                 * @instance
                 */
                self.isPhantom = function (pkValue, instance) {
                    return isPhantomFn(pkValue, instance);
                };
            }
        }
    );

    /**
     * Resource phantom id generator that generates negative integer IDs
     *
     * @name ResourcePhantomIdNegativeInt
     * @ngdoc object
     * @param {ResourcePhantomIdFactoryService} ResourcePhantomIdFactoryService Phantom ID factory service
     *
     * @example
     * // Using `ResourcePhantomIdNegativeInt`
     * inject(function (ResourceFactoryService, ResourcePhantomIdNegativeInt) {
     *     var
     *         service = ResourceFactoryService('TestResourceService', 'http://test/:pk/', {
     *             phantomIdGenerator: ResourcePhantomIdNegativeInt
     *         }),
     *         phantomInstance1 = service.new(),
     *         phantomInstance2 = service.new();
     *
     *     // Test if IDs are negative
     *     expect(phantomInstance1.pk).toBe(-1);
     *     expect(phantomInstance2.pk).toBe(-2);
     *
     *     // Test if instances are marked as phantom
     *     expect(phantomInstance1.$isPhantom()).toBe(true);
     *     expect(phantomInstance2.$isPhantom()).toBe(true);
     *
     *     // Change IDs
     *     phantomInstance1.pk = 1;
     *     phantomInstance2.pk = 2;
     *
     *     // Test if instances are marked as concrete for positive IDs
     *     expect(phantomInstance1.$isPhantom()).toBe(false);
     *     expect(phantomInstance2.$isPhantom()).toBe(false);
     * });
     */
    module.factory('ResourcePhantomIdNegativeInt',
        function (ResourcePhantomIdFactoryService) {
            'ngInject';

            var
                lastPkValue = 0;

            return ResourcePhantomIdFactoryService.createPhantomIdFactory({
                generate: function () {
                    return --lastPkValue;
                },
                is: function (pkValue) {
                    return pkValue &lt; 0;
                }
            });
        }
    );

    /**
     * Resource phantom id generator that generates UUID4 IDs
     *
     * @name ResourcePhantomIdUuid4
     * @ngdoc object
     * @param {ResourcePhantomIdFactoryService} ResourcePhantomIdFactoryService Phantom ID factory service
     *
     * @example
     * // Using `ResourcePhantomIdUuid4`
     * inject(function (ResourceFactoryService, ResourcePhantomIdUuid4) {
     *     var
     *         service = ResourceFactoryService('TestResourceService', 'http://test/:pk/', {
     *             phantomIdGenerator: ResourcePhantomIdUuid4
     *         }),
     *         phantomInstance1 = service.new(),
     *         phantomInstance2 = service.new();
     *
     *     // Test if IDs are valid UUID4s
     *     expect(phantomInstance1.pk).toMatch(/[\d\w]{8}-[\d\w]{4}-[\d\w]{4}-[\d\w]{4}-[\d\w]{12}/i);
     *     expect(phantomInstance2.pk).toMatch(/[\d\w]{8}-[\d\w]{4}-[\d\w]{4}-[\d\w]{4}-[\d\w]{12}/i);
     *
     *     // Test if instances are marked as phantom as long as UUID4s match one of the generated
     *     expect(phantomInstance1.$isPhantom()).toBe(true);
     *     expect(phantomInstance2.$isPhantom()).toBe(true);
     *
     *     // Change IDs
     *     phantomInstance1.pk = '00000000-0000-0000-0000-000000000000';
     *     phantomInstance2.pk = '11111111-1111-1111-1111-111111111111';
     *
     *     // Test if instances are marked as concrete for not generated UUID4s
     *     expect(phantomInstance1.$isPhantom()).toBe(false);
     *     expect(phantomInstance2.$isPhantom()).toBe(false);
     * });
     */
    module.factory('ResourcePhantomIdUuid4',
        function (ResourcePhantomIdFactoryService) {
            'ngInject';

            var
                generatedIds = [];

            return ResourcePhantomIdFactoryService.createPhantomIdFactory({
                generate: function () {
                    var
                        pkValue = uuid4();

                    generatedIds.push(pkValue);
                    return pkValue;
                },
                is: function (pkValue) {
                    return generatedIds.indexOf(pkValue) !== -1;
                }
            });

            function uuid4 () {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var
                        r = Math.random() * 16|0,
                        v = c === 'x' ? r : (r&amp;0x3|0x8);

                    return v.toString(16);
                });
            }
        }
    );
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<!-- <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> using the Minami theme.
</footer> -->

<script>prettyPrint();</script>
<!-- <script src="scripts/linenumber.js"></script> -->
</body>
</html>
